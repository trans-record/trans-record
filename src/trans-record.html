<link rel="import" href="components/polymer/polymer.html">
<link rel="import" href="components/core-ajax/core-ajax.html">
<link rel="import" href="components/core-list/core-list.html">
<link rel="import" href="components/paper-input/paper-input.html">
<!--<link rel="import" href="../../core-toolbar/core-toolbar.html">-->
<!--<link rel="import" href="../../core-scroll-header-panel/core-scroll-header-panel.html">-->
<!--<link rel="import" href="../../core-icon/core-icon.html">-->
<!--<link rel="import" href="../../core-icons/core-icons.html">-->
<!--<link rel="import" href="../../core-icon-button/core-icon-button.html">-->
<!--<link rel="import" href="../../paper-shadow/paper-shadow.html">-->
<!--<link rel="import" href="../../paper-spinner/paper-spinner.html">-->
<!--<link rel="import" href="../../core-image/core-image.html">-->
<link rel="import" href="components/core-scroll-threshold/core-scroll-threshold.html">

<polymer-element name="trans-record">
    <template>
        <core-ajax
            id="request"
            handleAs="json"
            url="http://www.corsproxy.com/www.bloomapi.com/api/search"
            on-core-response="{{ handleResponse }}"></core-ajax>
        <paper-input-decorator
            id="zipInput"
            label="Enter Zip"
            floatingLabel
            error="A valid zip/postal code is required!">
            <input
                is="core-input"
                on-blur="{{ updateZip }}"
                required value="{{ zip }}">
        </paper-input-decorator>
        <template repeat="{{ provider in providers }}">
            <div>{{ provider.business_name || provider.last_name + ', ' + provider.first_name }}</div>
        </template>
        <!--<core-scroll-threshold-->
            <!--id="threshold"-->
            <!--scrollTarget="{{ $.scroller }}"-->
            <!--lowerThreshold="10"-->
            <!--on-lower-trigger="{{ loadMore }}"-->
            <!--fit></core-scroll-threshold>-->
        <!--<div id="scroller" fit>-->
            <!--<template repeat="{{ provider in providers }}">-->
                <!--<div>{{ provider.business_name }}</div>-->
            <!--</template>-->
        <!--</div>-->
    </template>
    <script>
        Polymer( 'trans-record', {
            offset: 0,
            zip: null,
            params: {},
            createUrl: function (  ) {
                this.offset += 10;
                this.params = {
                    limit: 10,
                    key1: 'practice_address.zip',
                    op1: 'eq',
                    offset: this.offset,
                    value1: this.zip
                };
                this.$.request.params = JSON.stringify( this.params );
            },
            updateZip: function ( e, data, sender ) {
                this.$.zipInput.isInvalid = false;
                if ( this.params.value1 !== sender.value ) {
                    this.offset = 0;
                }
                if ( sender.value.match( /^\d{5}(?:[-\s]\d{4})?$/ ) ) {
                    this.createUrl();
                    this.$.request.go();
                } else {
                    this.$.zipInput.isInvalid = true;
                }
            },
            handleResponse: function ( e, data, sender ) {
                this.providers = data.response.result;
            }
        } );
    </script>
</polymer-element>
